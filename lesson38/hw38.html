<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Практика</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container">
      <div class="d-none align-items-center">
        <strong>Loading...</strong>
        <div
          class="spinner-border ml-auto"
          role="status"
          aria-hidden="true"
        ></div>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>
    <script>
      function loadData() {
        const spinner = document.body.querySelector('div[class="container"]');
        spinner.classList.add = "d-flex";
        fetch("https://dummyjson.com/users")
          .then((respons) => respons.json())
          .then((users) => users.users)
          .then((show) => {
            const div = document.createElement("div");
            spinner.after(div);
            const table = document.createElement("table");
            table.className =
              "table table-responsive-sm table-sm table-bordered table-striped";
            const tbody = document.createElement("tbody");
            const thead = document.createElement("thead");
            div.append(table);
            table.append(thead);
            table.append(tbody);
            const headers = Object.keys(show[0]);
            const tr = document.createElement("tr");
            thead.append(tr);
            headers.forEach((header) => {
              const th = document.createElement("th");
              th.className = "text-center";
              th.textContent = header;
              tr.append(th);
              th.style.cursor = "default";
            });
            renderTable(show);
            function renderTable(rows) {
              tbody.innerHTML = "";
              rows.forEach((row) => {
                const tr = document.createElement("tr");
                tbody.append(tr);
                headers.forEach((header) => {
                  const td = document.createElement("td");
                  td.className = "text-truncate";
                  td.style.maxWidth='150px'
                  td.textContent = row[header];
                  tr.append(td);
                });
              });
            }
            const sort = {
              propertyName: "",
              order: true,
            };
            console.log(sort.propertyName);
            thead.addEventListener("click", function (event) {
              if (event.target.tagName === "TH") {
                const sortBy = event.target.textContent;
                if (sort.propertyName === sortBy) {
                  sort.order = !sort.order;
                } else {
                  sort.order = true;
                }
                sort.propertyName = sortBy;
                console.log(sort.propertyName);
                show.sort((a, b) => {
                  console.log(a[sortBy]);
                  if (a[sortBy] > b[sortBy]) {
                    return 1;
                  } else if (a[sortBy] < b[sortBy]) {
                    return -1;
                  }
                  return 0;
                });
                if (!sort.order) {
                  show = show.reverse();
                }
                renderTable(show);
              }
            });
          })
          .finally(() => {
            spinner.classList.add = "d-none";
          });
      }
      loadData();
    </script>
  </body>
</html>
